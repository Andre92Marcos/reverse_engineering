ROP or return oriented programming is the idea of chaining together small snippets of assembly with stack control to cause the program to do more complex things.

There are intended gadgets and unintended gadgets; intended gadgets are instruction sequences that the developer meant for it to be there and unintended as you can imagine are instruction sequences that aren’t intended to be there by the developer.

Basically what we need to do is instead of returning to an address of a function in libc we wil return to these ROP gadgets.

## ROP gadgets

ROP gadgets are small instruction sequences ending with a “ret” instruction “c3”. Combining these gadgets will enable us to perform certain tasks and in the end conduct our attack.

The ROP gadget has to end with a “ret” to enable us to perform multiple sequences. Hence it is called return oriented.

With this gadgets we can:
	
	Load a constant into a register;
	Load from memory
	Store into memory
	Arithmetic operations
	System call

As in a buffer overflow attack the basic idea of overwriting the saved RIP is the same, but as arguments are passed in registers in a 64-bit program we will neeed to find a way to control the RDI register.

For example, if we needed control of both RDI and RSI, we might find two gadgets in our program that look like this

```
0x400c01: pop rdi; ret
0x400c03: pop rsi; pop r15; ret
```

We can setup a fake call stack with these gadets to sequentially execute them, poping values we control into registers, and then end with a jump to system.

## sources

https://ctf101.org/binary-exploitation/return-oriented-programming/

https://www.exploit-db.com/docs/english/28479-return-oriented-programming-(rop-ftw).pdf
